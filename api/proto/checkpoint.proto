syntax = "proto3";

package checkpoint;

option go_package = "my.domain/guestbook/api/proto";

// CheckpointService provides container checkpoint operations
service CheckpointService {
  // Checkpoint creates a checkpoint of a container
  rpc Checkpoint(CheckpointRequest) returns (CheckpointResponse);
  
  // ConvertCheckpointToImage converts a checkpoint tar file to OCI image format
  rpc ConvertCheckpointToImage(ConvertRequest) returns (ConvertResponse);
  
  // Health check for the service
  rpc Health(HealthRequest) returns (HealthResponse);
}

// CheckpointRequest contains the information needed to checkpoint a container
message CheckpointRequest {
  string pod_namespace = 1;
  string pod_name = 2;
  string container_name = 3;
  string pod_uid = 4;
}

// CheckpointResponse contains the result of a checkpoint operation
message CheckpointResponse {
  bool success = 1;
  string artifact_uri = 2;
  string message = 3;
  string error = 4;
}

// ConvertRequest contains the information needed to convert a checkpoint to OCI image
message ConvertRequest {
  string checkpoint_path = 1;
  string container_name = 2;
  string image_name = 3;
}

// ConvertResponse contains the result of a checkpoint to OCI image conversion
message ConvertResponse {
  bool success = 1;
  string image_reference = 2;
  string message = 3;
  string error = 4;
}

// HealthRequest for health checks
message HealthRequest {}

// HealthResponse for health checks
message HealthResponse {
  bool healthy = 1;
  string message = 2;
}
